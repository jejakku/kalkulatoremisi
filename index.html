<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JejakKu - Kalkulator Emisi Karbon</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Inter dari Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* Terapkan font Inter ke seluruh elemen body dan pastikan tidak ada margin/padding default */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box; /* Pastikan padding dan border termasuk dalam total lebar/tinggi */
        }
        /* Styling tambahan untuk modal agar muncul di atas segalanya */
        .modal-overlay {
            z-index: 1000; /* Pastikan modal di atas elemen lain */
        }
        .modal-content {
            z-index: 1001; /* Pastikan konten modal di atas overlay */
        }
    </style>
</head>
<body class="bg-gradient-to-br from-green-100 to-blue-200 flex items-center justify-center min-h-screen p-4">
    <div id="app-root"></div>

    <script type="text/javascript">
        // State management sederhana
        let electricityKWh = 0;
        let vehicleType = 'mobil';
        let transportKm = 0;
        let wasteKg = 0;
        let dietType = 'daging';
        let totalEmissions = 0;
        let emissionBreakdown = {};
        let treesEquivalent = 0;
        let staticSuggestions = '';
        let showInfoModal = false;

        // Emission factors (simplified and example values, in kg CO2e per unit)
        const EMISSION_FACTORS = {
            electricity: 0.5, // kg CO2e per kWh (example for coal-heavy grid)
            car: 0.18,        // kg CO2e per km (example for gasoline car)
            motorcycle: 0.08, // kg CO2e per km (example for gasoline motorcycle)
            publicTransport: 0.05, // kg CO2e per km (example for bus/train)
            waste: 0.5,       // kg CO2e per kg (example for landfill waste, assuming some methane)
            diet: {           // kg CO2e per month (simplified averages)
                daging: 250,    // High meat consumption
                vegetarian: 100, // Vegetarian diet
                vegan: 50       // Vegan diet
            }
        };

        // Faktor konversi untuk pohon: 1 pohon dewasa menyerap sekitar 21 kg CO2 per tahun
        const CO2_PER_TREE_PER_YEAR = 21; // kg CO2 per pohon per tahun

        // Fungsi untuk menghasilkan saran statis berdasarkan rincian emisi
        const getStaticSuggestions = (breakdown) => {
            if (Object.keys(breakdown).length === 0 || totalEmissions === 0) {
                return "Hitung jejak karbon Anda untuk mendapatkan saran personalisasi!";
            }

            let highestCategory = '';
            let highestEmission = 0;

            for (const category in breakdown) {
                if (breakdown[category] > highestEmission) {
                    highestEmission = breakdown[category];
                    highestCategory = category;
                }
            }

            let suggestions = "Berikut adalah beberapa saran untuk mengurangi jejak karbon Anda:\n\n";

            switch (highestCategory) {
                case 'listrik':
                    suggestions += "Fokus pada penghematan listrik:\n";
                    suggestions += "- Matikan lampu dan peralatan elektronik saat tidak digunakan.\n";
                    suggestions += "- Cabut charger dan perangkat yang tidak digunakan (phantom load).\n";
                    suggestions += "- Gunakan lampu LED yang hemat energi.\n";
                    suggestions += "- Manfaatkan cahaya alami sebisa mungkin.\n";
                    suggestions += "- Pertimbangkan untuk menggunakan peralatan elektronik hemat energi.\n";
                    break;
                case 'transportasi':
                    suggestions += "Fokus pada pengurangan emisi transportasi:\n";
                    suggestions += "- Gunakan transportasi umum lebih sering.\n";
                    suggestions += "- Berjalan kaki atau bersepeda untuk jarak dekat.\n";
                    suggestions += "- Pertimbangkan untuk carpooling atau berbagi kendaraan.\n";
                    suggestions += "- Rawat kendaraan Anda agar efisien bahan bakar.\n";
                    suggestions += "- Jika memungkinkan, pertimbangkan kendaraan listrik atau hibrida.\n";
                    break;
                case 'sampah':
                    suggestions += "Fokus pada pengelolaan sampah yang lebih baik:\n";
                    suggestions += "- Kurangi penggunaan produk sekali pakai, terutama plastik.\n";
                    suggestions += "- Daur ulang sampah anorganik (plastik, kertas, logam, kaca).\n";
                    suggestions += "- Kompos sampah organik untuk pupuk.\n";
                    suggestions += "- Beli produk dengan kemasan minimal atau dapat didaur ulang.\n";
                    suggestions += "- Perbaiki barang yang rusak daripada langsung membuangnya.\n";
                    break;
                case 'makanan':
                    suggestions += "Fokus pada pola makan yang lebih berkelanjutan:\n";
                    suggestions += "- Kurangi konsumsi daging merah dan produk susu.\n";
                    suggestions += "- Tingkatkan konsumsi makanan nabati, seperti sayuran, buah-buahan, dan biji-bijian.\n";
                    suggestions += "- Beli makanan lokal dan musiman untuk mengurangi jejak transportasi.\n";
                    suggestions += "- Hindari membuang-buang makanan.\n";
                    suggestions += "- Pertimbangkan untuk menanam makanan Anda sendiri jika memungkinkan.\n";
                    break;
                default:
                    suggestions += "Secara umum, Anda bisa:\n";
                    suggestions += "- Hemat energi di rumah dan tempat kerja.\n";
                    suggestions += "- Pilih transportasi yang lebih ramah lingkungan.\n";
                    suggestions += "- Kurangi dan daur ulang sampah Anda.\n";
                    suggestions += "- Adopsi pola makan yang lebih berkelanjutan.\n";
                    suggestions += "- Dukung energi terbarukan dan inisiatif hijau di komunitas Anda.\n";
                    break;
            }
            suggestions += "\nSetiap langkah kecil berarti besar! Mari bersama menciptakan Indonesia bebas emisi.";
            return suggestions;
        };

        // Fungsi untuk menghitung emisi
        function calculateEmissions() {
            let electricityEmissions = 0;
            let transportEmissions = 0;
            let wasteEmissions = 0;
            let dietEmissions = 0;

            // Hitung emisi listrik
            electricityEmissions = parseFloat(electricityKWh) * EMISSION_FACTORS.electricity;

            // Hitung emisi transportasi
            const distance = parseFloat(transportKm);
            switch (vehicleType) {
                case 'mobil':
                    transportEmissions = distance * EMISSION_FACTORS.car;
                    break;
                case 'motor':
                    transportEmissions = distance * EMISSION_FACTORS.motorcycle;
                    break;
                case 'umum':
                    transportEmissions = distance * EMISSION_FACTORS.publicTransport;
                    break;
                case 'sepeda/jalan kaki':
                    transportEmissions = 0; // Tidak ada emisi langsung
                    break;
                default:
                    break;
            }

            // Hitung emisi sampah
            wasteEmissions = parseFloat(wasteKg) * EMISSION_FACTORS.waste * 4; // Asumsi 4 minggu dalam sebulan

            // Hitung emisi diet
            dietEmissions = EMISSION_FACTORS.diet[dietType] || 0;

            const total = electricityEmissions + transportEmissions + wasteEmissions + dietEmissions;

            totalEmissions = total;
            emissionBreakdown = {
                listrik: electricityEmissions,
                transportasi: transportEmissions,
                sampah: wasteEmissions,
                makanan: dietEmissions,
            };

            // Hitung ekuivalen pohon
            const annualEmissions = total * 12; // Emisi tahunan
            treesEquivalent = annualEmissions / CO2_PER_TREE_PER_YEAR;

            // Set static suggestions based on new breakdown
            staticSuggestions = getStaticSuggestions(emissionBreakdown);
            updateUI(); // Perbarui UI setelah perhitungan
        }

        // Fungsi untuk mengatur ulang semua input dan hasil
        function resetCalculator() {
            electricityKWh = 0; // Reset ke 0
            vehicleType = 'mobil';
            transportKm = 0; // Reset ke 0
            wasteKg = 0; // Reset ke 0
            dietType = 'daging';
            totalEmissions = 0;
            emissionBreakdown = {};
            treesEquivalent = 0;
            staticSuggestions = '';
            updateUI(); // Perbarui UI setelah reset
        }

        // Fungsi untuk melampirkan event listeners secara programatis
        function attachEventListeners() {
            // Input fields
            document.getElementById('electricity')?.addEventListener('change', (e) => { electricityKWh = parseFloat(e.target.value) || 0; updateUI(); });
            document.getElementById('transportKm')?.addEventListener('change', (e) => { transportKm = parseFloat(e.target.value) || 0; updateUI(); });
            document.getElementById('vehicleType')?.addEventListener('change', (e) => { vehicleType = e.target.value; updateUI(); });
            document.getElementById('waste')?.addEventListener('change', (e) => { wasteKg = parseFloat(e.target.value) || 0; updateUI(); });
            document.getElementById('diet')?.addEventListener('change', (e) => { dietType = e.target.value; updateUI(); });

            // Buttons
            document.getElementById('calculateButton')?.addEventListener('click', calculateEmissions);
            document.getElementById('resetButton')?.addEventListener('click', resetCalculator);
            document.getElementById('infoButton')?.addEventListener('click', () => { showInfoModal = true; updateUI(); });

            // Modal close buttons
            document.getElementById('modalCloseButton')?.addEventListener('click', () => { showInfoModal = false; updateUI(); });
            document.getElementById('modalOverlayCloseButton')?.addEventListener('click', () => { showInfoModal = false; updateUI(); });

            console.log("Event listeners re-attached.");
        }

        // Fungsi untuk memperbarui UI berdasarkan state
        function updateUI() {
            const appHtml = `
                <div class="bg-white p-8 rounded-xl shadow-2xl w-full max-w-2xl transform transition-all duration-300 hover:scale-[1.01] border border-gray-200">
                    <h1 class="text-4xl font-extrabold text-center text-green-700 mb-6 drop-shadow-sm">
                        JejakKu
                    </h1>
                    <p class="text-center text-gray-600 mb-8">
                        Hitung perkiraan emisi karbon Anda dan temukan cara untuk berkontribusi pada Indonesia bebas emisi!
                    </p>

                    <!-- User ID (Firebase tidak digunakan di versi satu file ini untuk kesederhanaan) -->
                    <div class="text-sm text-gray-500 text-center mb-4 p-2 bg-gray-50 rounded-lg">
                        ID Pengguna Anda: <span class="font-mono break-all">ID_Pengguna_Anonim</span>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <!-- Electricity Input -->
                        <div class="flex flex-col">
                            <label for="electricity" class="text-lg font-semibold text-gray-700 mb-2">
                                Konsumsi Listrik Bulanan (kWh):
                            </label>
                            <input
                                type="number"
                                id="electricity"
                                class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200"
                                placeholder="Contoh: 200"
                                value="${electricityKWh}"
                            />
                        </div>

                        <!-- Transportation Input -->
                        <div class="flex flex-col">
                            <label for="transportKm" class="text-lg font-semibold text-gray-700 mb-2">
                                Jarak Tempuh Transportasi Bulanan (km):
                            </label>
                            <input
                                type="number"
                                id="transportKm"
                                class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200"
                                placeholder="Contoh: 500"
                                value="${transportKm}"
                            />
                            <label for="vehicleType" class="text-sm text-gray-600 mt-2 mb-1">
                                Jenis Kendaraan:
                            </label>
                            <select
                                id="vehicleType"
                                class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200"
                            >
                                <option value="mobil" ${vehicleType === 'mobil' ? 'selected' : ''}>Mobil Pribadi</option>
                                <option value="motor" ${vehicleType === 'motor' ? 'selected' : ''}>Motor Pribadi</option>
                                <option value="umum" ${vehicleType === 'umum' ? 'selected' : ''}>Transportasi Umum</option>
                                <option value="sepeda/jalan kaki" ${vehicleType === 'sepeda/jalan kaki' ? 'selected' : ''}>Sepeda/Jalan Kencang</option>
                            </select>
                        </div>

                        <!-- Waste Input -->
                        <div class="flex flex-col">
                            <label for="waste" class="text-lg font-semibold text-gray-700 mb-2">
                                Sampah Dihasilkan Mingguan (kg):
                            </label>
                            <input
                                type="number"
                                id="waste"
                                class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200"
                                placeholder="Contoh: 5"
                                value="${wasteKg}"
                            />
                        </div>

                        <!-- Diet Input -->
                        <div class="flex flex-col">
                            <label for="diet" class="text-lg font-semibold text-gray-700 mb-2">
                                Pola Makan:
                            </label>
                            <select
                                id="diet"
                                class="p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all duration-200"
                            >
                                <option value="daging" ${dietType === 'daging' ? 'selected' : ''}>Pemakan Daging (tinggi)</option>
                                <option value="vegetarian" ${dietType === 'vegetarian' ? 'selected' : ''}>Vegetarian</option>
                                <option value="vegan" ${dietType === 'vegan' ? 'selected' : ''}>Vegan</option>
                            </select>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex flex-col sm:flex-row gap-4 justify-center mb-8">
                        <button
                            id="calculateButton"
                            class="flex-1 bg-green-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-green-700 transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-75"
                        >
                            Hitung Emisi
                        </button>
                        <button
                            id="resetButton"
                            class="flex-1 bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded-lg shadow-md hover:bg-gray-400 transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-opacity-75"
                        >
                            Reset
                        </button>
                        <button
                            id="infoButton"
                            class="flex-1 bg-blue-500 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-blue-600 transition-all duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-75"
                        >
                            Tentang Faktor Emisi
                        </button>
                    </div>

                    <!-- Results Display -->
                    ${totalEmissions > 0 ? `
                        <div class="bg-green-50 p-6 rounded-xl border border-green-200 shadow-inner">
                            <h2 class="text-2xl font-bold text-green-800 mb-4 text-center">
                                Perkiraan Jejak Karbon Anda:
                            </h2>
                            <p class="text-5xl font-extrabold text-center text-green-900 mb-6">
                                ${totalEmissions.toFixed(2)} kg CO2e/bulan
                            </p>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-gray-700">
                                ${Object.entries(emissionBreakdown).map(([category, value]) => `
                                    <div class="flex justify-between items-center bg-white p-3 rounded-lg shadow-sm">
                                        <span class="font-medium capitalize">${category}:</span>
                                        <span class="font-semibold text-green-600">${value.toFixed(2)} kg CO2e</span>
                                    </div>
                                `).join('')}
                            </div>

                            <!-- Trees Equivalent Display -->
                            <div class="mt-8 text-center bg-green-100 p-4 rounded-lg border border-green-300">
                                <p class="text-lg font-semibold text-green-800">
                                    Untuk mengimbangi emisi tahunan Anda, Anda perlu menanam sekitar:
                                </p>
                                <p class="text-4xl font-extrabold text-green-900 mt-2">
                                    ${Math.ceil(treesEquivalent)} pohon setiap tahun
                                </p>
                                <p class="text-sm text-gray-600 mt-2">
                                    (Estimasi berdasarkan 1 pohon dewasa menyerap sekitar ${CO2_PER_TREE_PER_YEAR} kg CO2 per tahun)
                                </p>
                            </div>

                            <p class="text-center text-gray-600 mt-6 text-sm">
                                *Angka ini adalah perkiraan berdasarkan faktor emisi standar. Hasil sebenarnya dapat bervariasi.
                            </p>

                            <!-- Static Suggestions Section -->
                            <div class="mt-8 pt-6 border-t border-gray-200">
                                <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">
                                    Saran Personalisasi untuk Anda
                                </h3>
                                ${staticSuggestions ? `
                                    <div class="mt-4 p-4 bg-purple-50 rounded-lg border border-purple-200 text-gray-800 whitespace-pre-wrap">
                                        ${staticSuggestions}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    ` : ''}

                    <!-- Info Modal -->
                    ${showInfoModal ? `
                        <div class="fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center p-4 modal-overlay">
                            <div class="bg-white p-8 rounded-xl shadow-2xl max-w-md w-full relative modal-content">
                                <h3 class="text-2xl font-bold text-gray-800 mb-4">Tentang Faktor Emisi</h3>
                                <p class="text-gray-700 mb-4">
                                    Kalkulator ini menggunakan faktor emisi perkiraan untuk menghitung jejak karbon Anda. Faktor-faktor ini adalah nilai rata-rata global atau contoh dan mungkin tidak secara akurat mencerminkan kondisi spesifik di Indonesia atau kebiasaan pribadi Anda.
                                </p>
                                <ul class="list-disc list-inside text-gray-600 mb-4">
                                    <li>**Listrik:** Emisi per kWh sangat bervariasi tergantung sumber energi (batu bara, gas, terbarukan).</li>
                                    <li>**Transportasi:** Emisi per km tergantung pada efisiensi bahan bakar kendaraan, jenis bahan bakar, dan kondisi lalu lintas.</li>
                                    <li>**Sampah:** Emisi dari sampah bergantung pada metode pengelolaannya (TPA, daur ulang, kompos).</li>
                                    <li>**Makanan:** Jejak karbon makanan sangat dipengaruhi oleh jenis makanan (daging vs. nabati), produksi, dan transportasi.</li>
                                </ul>
                                <p class="text-gray-700 mb-6">
                                    Untuk hasil yang lebih akurat, disarankan untuk mencari data faktor emisi yang lebih spesifik untuk wilayah Anda.
                                </p>
                                <button
                                    id="modalCloseButton"
                                    class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-3xl font-bold"
                                >
                                    &times;
                                </button>
                                <button
                                    id="modalOverlayCloseButton"
                                    class="w-full bg-green-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-green-700 transition-all duration-300"
                                >
                                    Tutup
                                </button>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
            const rootElement = document.getElementById('app-root');
            if (rootElement) {
                rootElement.innerHTML = appHtml;
                console.log("UI updated successfully.");
                attachEventListeners(); // Panggil event listeners setelah HTML dirender
            } else {
                console.error("Elemen 'app-root' tidak ditemukan.");
            }
        }

        // Panggil updateUI() setelah DOM sepenuhnya dimuat
        document.addEventListener('DOMContentLoaded', updateUI);
    </script>
</body>
</html>
